$(function(){var $body=$("body");$body.on("click",".remind-block-div .block-icon-levers",function(){$(this).find(".b-description-wrap-remind").toggle()});$body.on("click","a.logOut",function(e){$("a.logOut").parent().off();if(!window.user["is_admin"]&&!confirm("Вы точно хотите выйти?")){e.preventDefault();return false}});$("div.tabs-admin  > div").hide().filter(":first").show();$("div.tabs-admin1  > div").hide().filter(":first").show();$body.on("click","div.tabs-admin  ul.tabNavigation a",function(){var $block=$("div.tabs-admin > div");$block.hide();$block.filter("#"+$(this).attr("data-id")).show();$("div.tabs-admin  ul.tabNavigation a").removeClass("active");$(this).addClass("active");return false});$body.on("click","div.tabs-admin1  ul.tabNavigation a",function(){var $block=$("div.tabs-admin1 > div");$block.hide();$block.filter("#"+$(this).attr("data-id")).show();$("div.tabs-admin1  ul.tabNavigation a").removeClass("active");$(this).addClass("active");return false});$body.on("mouseover mouseout",".b-teacher_block__info",function(){$(this).find(".b-description-wrap-remind").toggle()});$body.on("click",".j-block-description-remind-image",function(){$(".typeRemindValue").text($(this).attr("data-text"));$(".block-description-remind-image").removeClass("checked");$(this).toggleClass("checked");if($(this).attr("data-post-id")>0){$.ajax({type:"POST",url:"/",data:{ajax_action:"ajax_setRemindValue",post_id:$(this).attr("data-post-id"),remind_value:$(this).attr("data-value"),type_remind:$(this).attr("data-work")}});if($(this).attr("data-value")==0){$(".remind").attr("src","/wp-content/themes/english/assets/antago/img/remind.svg");$(".text-remind-work").html(localize({l:"you_will_not_receive_nitification",v:"вам не придет уведомление",t:"first",n:"tasks"}))}else{$(".text-remind-work").html(localize({l:"you_will_be_notified_by_mail",v:"вам придет уведомление на почту",t:"first",n:"tasks"}));$(".remind").attr("src","/wp-content/themes/english/assets/antago/img/remind_check.svg")}}});$("#open-faq-list").on("click",function(){if($(this).hasClass("active")){$(this).removeClass("active").text("Открыть все");$(".js-faq-title").removeClass("active");$(".js-faq-body").removeClass("open")}else{$(this).addClass("active").text("Скрыть все");$(".js-faq-title").addClass("active");$(".js-faq-body").addClass("open")}return false});$(".js-faq-title").on("click",function(){if($(this).hasClass("active")){$(this).removeClass("active");$(this).next(".js-faq-body").removeClass("open");document.location.hash=""}else{$(this).addClass("active");$(this).next(".js-faq-body").addClass("open");document.location.hash=$(this).closest("li").attr("id")}return false});if(document.location.hash.length>1&&document.location.hash.indexOf("faq")>-1){$(document.location.hash).find(".js-faq-title").trigger("click")}$(".js-btn-popover").on("click",function(){var popoverId=$(this).data("rel");if($(this).hasClass("active")){$(this).removeClass("active");$(popoverId).removeClass("open")}else{$(this).addClass("active");$(popoverId).addClass("open")}var popWrap=$("#settings_popup_wrap");popWrap.css({left:$(this).offset().left-popWrap.outerWidth()+36,top:$(this).offset().top+35});return false});$("html").bind("click touchstart",function(e){if($(e.target).is("#settings_popup_wrap")||$(e.target).parents("#settings_popup_wrap").length){return!!($(e.target).is("label")||$(e.target).is("input"))}var popoverId=$(".js-btn-popover").removeClass("active").data("rel");$(popoverId).removeClass("open")});$body.on("click",".js-tab-link",function(){var targetId=$(this).attr("href")||$(this).data("rel"),parentContainer=$(this).closest(".js-tab");if(!$(this).hasClass("active")){parentContainer.find(".js-tab-link").removeClass("active");parentContainer.find(".js-tab-container").removeClass("open");$(this).addClass("active");$(targetId).addClass("open")}return false});$(".js-btn-dictionary").on("click",function(){var widget=$("#widget-dictionary-popup");if($(this).hasClass("active")){$(this).removeClass("active");widget.removeClass("open")}else{$(this).addClass("active");widget.addClass("open")}return false});$(".level__item--auth").on("click",function(e,noSave){var self=$(this);$(".level__item--auth").removeClass("active");if(!self.hasClass("active")){self.addClass("active")}if(self.parents(".user-settings__level-list").length>0){var targetText="#"+$(this).data("level");$(".user-settings__level-text-item").css("display","none");$(".user-settings__level-text").find(targetText).css("display","")}var level=1;var body=$(document.body);for(var i=1;i<=5;i++){var hasClass=self.hasClass("level-"+i);if(hasClass)level=i;body.toggleClass("level-"+i,hasClass)}for(i=1;i<=5;i++){$("#video-carousel-"+i).sly("reload").sly("toStart")}var serials=$("#all-serials-slide").find(".b-list-serials");var levelClass="level-"+level;serials.children().sort(function(a,b){var av=$(a).hasClass(levelClass)?1:0;var bv=$(b).hasClass(levelClass)?1:0;return av>bv?-1:av<bv?1:0}).detach().appendTo(serials);if(!noSave){$.ajax({type:"POST",url:"/",data:{ajax_action:"ajax_level_selected",level:level},dataType:"json"});$("#slide1").find(".n-block__1").addClass("j-show-hide");$("#level_selected").text(self.text().trim());if(level==4){$(".teacher-role__go__to__pupils").show()}else{$(".teacher-role__go__to__pupils").hide()}}return false});if($(".video-carousel__slider").length!=0){var initSlidersById=function(id){var $frame=$(id);var $wrap=$frame.parent();$frame.sly({horizontal:1,itemNav:"basic",smart:0,activateOn:"click",mouseDragging:1,touchDragging:1,releaseSwing:1,startAt:0,scrollBy:1,pagesBar:$wrap.find(".pages"),activatePageOn:"click",speed:300,elasticBounds:1,easing:"easeOutExpo",dragHandle:1,dynamicHandle:1,clickBar:1,prevPage:$wrap.find(".prevPage"),nextPage:$wrap.find(".nextPage")})};initSlidersById("#video-carousel-1");initSlidersById("#video-carousel-2");initSlidersById("#video-carousel-3");initSlidersById("#video-carousel-4");initSlidersById("#video-carousel-5")}var initSlidersSerialsById=function(id){var $frame=$(id);if($frame.length!=0&&$(window).width()<1100){var $wrap=$frame.parent();$frame.sly({horizontal:1,itemNav:"basic",smart:0,activateOn:"click",mouseDragging:1,touchDragging:1,releaseSwing:1,startAt:0,scrollBy:1,pagesBar:$wrap.find(".pages"),activatePageOn:"click",speed:300,elasticBounds:1,easing:"easeOutExpo",dragHandle:1,dynamicHandle:1,clickBar:1,prevPage:$wrap.find(".prevPage"),nextPage:$wrap.find(".nextPage")})}else{}};initSlidersSerialsById("#serial-carousel-1");$(window).resize(function(){initSlidersSerialsById("#serial-carousel-1")});$("#load-more-serals").on("click",function(){if($(window).width()>1200){$(this).parent().remove();$("#all-serials-slide").find(".only-first-three").removeClass("only-first-three");return false}});$body.on("submit",".js-comment-ajax",function(e){e.preventDefault();var form=$(this);if($.trim($("[name=comment]",form).val()).length<7&&(!window.user||!user.can_editposts)){alert("Текст сообщения слишком короткий");return}if(!user.logged_in){new SigninPopup(function(res){var popup=this;if(res.user_id){user.logged_in=true;this.hide();form.submit(function(){popup.onLogin(res)});form.submit()}return false}).show();return false}form.find("[type=submit]").prop("disabled",true);var customTranslation=$(this).closest(".j-phrase_comments_container").find(".comment-music_custom-translation:first small").text();if(customTranslation){customTranslation="\nАвторский перевод строчки: "+customTranslation;var text=form.find('textarea[name="comment"]').val();text=text.replace(customTranslation,"");form.find('textarea[name="comment"]').val(text+customTranslation)}var url=form.attr("action");var data=form.serialize();$.post(url,data,function(html){if(!/^\s*<li/.test(html)){$(".puzzle-comment_form_error").html(html).show();return}form.parents(".nocomments").removeClass("nocomments");$(".b-add_comment__text, .puzzle-input",form).val("");if(form.parents(".comments-oncompleted").length&&!form.parents("li.comment").length){form.parents(".comments-oncompleted").find(".comments").append(html);form.parents(".add-comment-wrap").remove()}else{var is_reply=form.parents(".j-show_reply_block").length;if(is_reply){form.parents(".j-show_reply_block").replaceWith(html)}else{if(form.parents(".j-comments_block").length){if(form.parents(".j-phrase_comments_container").length){form.parents(".j-comments_block:last").find("ul.comments").append(html)}else{var $ul=form.parents(".j-comments_block:last").children("ul.comments");$ul.prepend(html);var $li=$ul.children("li:first").addClass("fade-transition");setTimeout(function(){$li.addClass("fadeout-transition");setTimeout(function(){$li.removeClass("fade-transition fadeout-transition")},1e3)},1e3);var comment_id=$.trim(html).replace(/.* id="(.*?)"[\s\S]*$/,"$1");location.hash="#"+comment_id}}else{form.parents(".b-add_comment").before(html)}}}document.dispatchEvent(new CustomEvent("pe.comments.onCreated",{detail:{pieceIndex:+form.find('input[name="comment_phrase"]').val()}}))}).always(function(){form.find("[type=submit]").prop("disabled",false)})});if(window.videoExercise){var videoButtons=$("#video-buttons");$(document).keydown(function(e){if($(e.target).is("input, textarea, [contenteditable]"))return;if(e.which==49){ytplayer.playVideo()}if(e.which==50){if(typeof user_progress!="undefined"&&user_progress=="start_again"){window.location.href=window.location.href+"/work?start_again"}else if(typeof user_progress!="undefined"&&user_progress=="start_new"){window.location.href=window.location.pathname+"/work"}}})}$(document).ready(function(){var body=$body;body.on("mouseenter",".b-similar_video__slide",function(){$(this).addClass("is-hover")}).on("mouseleave",".b-similar_video__slide",function(){$(this).removeClass("is-hover")});body.on("mouseenter",".comment-likes",function(){$(this).find("button").addClass("is-hover");$(this).find("span.comment-word").addClass("hide")}).on("mouseleave",".comment-likes",function(){$(this).find("button").removeClass("is-hover");$(this).find("span.comment-word").removeClass("hide")})});$body.on("click",".b-edit_comment__send_btn",function(e){e.preventDefault();var comment_ID=$(this).closest("li").data("id"),comment=$(this).closest("form").find("textarea").val(),self=$(this);if(comment.length<=10)return;$.post("/",{ajax_action:"ajax_common_editComment",comment_ID:comment_ID,comment:comment},function(){if(!(user.can_editposts||user.is_admin)){comment=comment.replace(/(\n){2,}/g,"\n")}self.closest("form").replaceWith($("<p/>").html(comment.replace(/\n/g,"<br>")))},"json")})});function approveComment(comment_id){$.ajax({type:"POST",url:"/",data:{ajax_action:"ajax_approve_comment",comment_id:comment_id,type:$("#comment-"+comment_id+" a.comment-approve").eq(0).text()=="Одобрить"?1:0},dataType:"json"});if($("#comment-"+comment_id+" a.comment-approve").eq(0).text()=="Одобрить"){$("#comment-"+comment_id+" a.comment-approve").eq(0).text("Отвергнуть");$("#comment-"+comment_id+" footer.comment-meta").eq(0).after($("<span/>").addClass("author-role approve").text("Комментарий одобрен экспертом Puzzle English"))}else{$("#comment-"+comment_id+" span.author-role.approve").eq(0).remove();$("#comment-"+comment_id+" a.comment-approve").eq(0).text("Одобрить")}}function deleteComment(comment_id){if(confirm("Подтвердите удаление комментария")){$.post(HOME,{ajax_action:"ajax_delete_comment",id:comment_id},function(resp){if(resp.success){var $comment=$("#comment-"+comment_id);var countCommentTemp=$comment.closest("li.balloon-row").find(".b-phrases_block__comment_amount").html();var pieceIndex=$comment.closest(".j-react__phrase-comment-list").data("piece_index");var countComment=0;if(countCommentTemp===undefined)countComment=$comment.closest("div.writing-list__item").find(".puzzle-news__list-item-comments").html();else countComment=countCommentTemp;if(/comment-feed/.test(location.href)){$("div#hideOneComment_"+comment_id+" li#comment-"+comment_id).remove()}countComment=parseInt(countComment);if(isNaN(countComment)||countComment<=0)countComment=1;countComment--;if(countCommentTemp===undefined)$comment.closest("div.writing-list__item").find(".puzzle-news__list-item-comments").html(countComment);else $comment.closest("li.balloon-row").find(".b-phrases_block__comment_amount").html(countComment);$comment.remove();document.dispatchEvent(new CustomEvent("pe.comments.onDeleted",{detail:{pieceIndex:+pieceIndex}}))}else{setTimeout(function(){$(".comment[data-id="+comment_id+"] a.comment-delete").fadeOut("fast")},1e3*60*15);alert("Невозможно удалить комментарий")}},"json")}}function editComment(comment_id){var $comment=$("#comment-"+comment_id);var comment_content=$comment.find("div.comment-content > p").html();var $form=$("#edit-comment-template").clone();$form.find("textarea").html(comment_content.replace(/<br>/g,"\n"));$comment.find("div.comment-content:first").html($form.html())}