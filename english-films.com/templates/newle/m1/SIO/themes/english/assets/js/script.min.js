"use strict";var gcmServer="https://android.googleapis.com/gcm/send/";function Popup(elementId,options){var self=this,shown_at;self.element=$("#"+elementId);this.visible=false;this.show=function(animation){if(!self.visible){self.element.find(".clear-on-open").empty();shown_at=false;if(animation===false){self.element.show()}else{self.element.fadeIn(350)}setTimeout(function(){self.element.delay(1).queue(function(){shown_at=+new Date;self.element.dequeue();if(elementId=="sign_in"){if(cookie.get("last_login"))$("#sign_in_popup_form [type=password]").focus()}});self.visible=true},1);if(typeof options!=="undefined"&&options.onShow&&typeof options.onShow==="function"){options.onShow(self.element)}}if($("html").hasClass("ios"))$("body").css("position","fixed")};this.hide=function(animation){if(self.visible){if(shown_at&&new Date-shown_at>200){if(animation===false){self.element.hide()}else{self.element.fadeOut(350)}self.element.delay(300).queue(function(){self.element.hide().dequeue();self.element.find(".feedback-form-wrap").removeClass("success");self.element.find(".success").hide();self.element.find(".main_content").show();self.element.find(".message.response-message").text("")});self.visible=false;if(elementId=="show_web_push"){window.location.reload()}}}if(typeof options!=="undefined"&&options.onHide&&typeof options.onHide==="function"){options.onHide(self.element)}if($("html").hasClass("ios"))$("body").css("position","")};self.element.find(".close").on("click",this.hide).on("touchend",this.hide).html(svg_icons.close2.cloneNode(true));function checkAndHide(e){if(e.target==this)self.hide();if($("body").is(".puzzle_ov_h")){$("body").removeClass("puzzle_ov_h")}}self.element.on("click",checkAndHide).on("touchmove",checkAndHide).on("mousewheel",function(e){if(elementId!="tank_invite_vk"){e.preventDefault();e.stopPropagation()}})}function reloadPageAfterSignInOrUp(res){if(res.logged_in_cookie&&res.logged_in_cookie_name){cookie.set(res.logged_in_cookie_name,res.logged_in_cookie,365,"/");cookie.set("last_login",res.login,365,"/")}if(res.redirect_to){document.location.href=res.redirect_to}else{document.location.reload()}}function SignPopup(callback){Popup.call(this,"sign_popup")}function reloadCaptcha(form,force){var input=form.find(".b-reg__captcha__img");if(force)input.css("background-image","none");if(input.length==1&&input.css("background-image")=="none"){if(form.data("loading_captcha"))return;form.data("loading_captcha","yes");form.find("input[name=captcha]").val("").focus();$.post(MAIN_FULL_DOMAIN+"/",{ajax_action:"ajax_get_captcha",bgcolor:input.css("background-color")},function(result){form.data("loading_captcha",null);if(result.length>5){form.find(".b-reg__captcha__reload").show();input.css("background-image","url(data:image/png;base64,"+result+")");form.find(".b-reg_captcha_panel").show()}},"jsonp")}}var NewPassForm=function(){var that=this;var form=$("#reset_pass_form");form.on("submit",function(e){e.preventDefault();var pass1=form.find("input[name=pass1]").val();var pass2=form.find("input[name=pass2]").val();var key=form.find("input[name=key]").val();var login=form.find("input[name=login]").val();if(pass1!=pass2){showMessage("Пароли не совпадают",1);return}else if(!pass1||!pass2){showMessage("Пароль слишком короткий",1);return}form.find("button").prop("disabled",true);$.post("/",{ajax_call:"reset_password",new_password:pass1,key:key,login:login},function(res){if(!res.error){window.location=location.origin;return}showMessage(res.message,res.error)},"json").always(function(){form.find("button").prop("disabled",false)})});form.find("input[name=pass1]").on("input",removeMessage);form.find("input[name=pass2]").on("input",removeMessage);function removeMessage(){form.find(".messages").empty()}function showMessage(message,error){form.find(".messages").empty().append($('<div class="message" />').html(message).toggleClass("success",!error).toggleClass("error",!!error))}};var RetrievePasswordForm=function(){var form=$("#retrieve_pass_form");form.on("submit",function(e){e.preventDefault();var login=form.find("input[name=user_login]").val();if(!login){showMessage("Введите ваш email",true);return}$.post(MAIN_FULL_DOMAIN+"/",{ajax_action:"ajax_retrieve_password",captcha:form.find("input[name=captcha]").val(),user_login:login||user.login},function(res){if(!res.error){$(".page-wrapper").html(res.message);return}showMessage(res.message,res.error)},"jsonp")});form.find("input").on("input",removeMessage);function removeMessage(){form.find(".messages").hide();form.find("button[type=submit]").show();form.find(".messages").empty()}function showMessage(message,error){form.find(".messages").empty().append($('<div class="message" />').html(message).toggleClass("success",!error).toggleClass("error",!!error));form.find("button[type=submit]").hide();form.find(".messages").show();form.find("img.captcha")[0].src+=Math.random();form.find("input[name=captcha]").val("")}};var show_academy_next_lesson=function(){Popup.call(this,"show_academy_next_lesson")};var show_modalInfo=function(){Popup.call(this,"showModalInfo")};var show_friends_add=function(){Popup.call(this,"show_friends_add")};var popupWebPush=function(){Popup.call(this,"show_web_push")};var ContactPopup=function(options){var url=location.href;this.setUrl=function(object_url){url=location.protocol+"//"+location.hostname+object_url};options.onShow=function(){$(".feedback-form img.captcha").attr("src","/tools/captcha/captcha.php?aspng="+Math.random())};try{Popup.call(this,"contact_us",options)}catch(e){console.log(e)}$(".feedback-form img.captcha_reload").on("click",options.onShow);$(".feedback-form").submit(function(e){e.preventDefault();var form=this;var $wrap=$(form).closest(".feedback-form-wrap");var $user_file=$("#user_file");$("button",form).prop("disabled",true);$wrap.removeClass("error success message");var formData=new FormData;var reqArray=$(form).serialize().split("&");var keyValue=[];for(var i=0;i<reqArray.length;i++){keyValue=reqArray[i].split("=");formData.append(keyValue[0],decodeURIComponent(keyValue[1]))}formData.append("url",url);if($user_file.val()){formData.append("attachedFile",$user_file.get(0).files[0],$user_file.val())}$.ajax({url:"/",data:formData,processData:false,contentType:false,type:"post",dataType:"json",success:function(res){if(res&&res.success){$wrap.addClass("success");form["message"].value=""}else{$wrap.addClass("error")}if(res.message){options.onShow();$wrap.addClass("message").find(".message").addClass("response-message").html(res.message)}setTimeout(function(){$("button",form).prop("disabled",false)},2e3)}})})};var ChangeEmailPopup=function(){Popup.call(this,"change_email");var form=this.form=document.getElementById("change_email_form");var jq_form=$("#change_email");form.onsubmit=function(e){e.preventDefault();$("button",form).prop("disabled",true);var req=$(form).serialize();req+="&url="+encodeURIComponent(location.href);$.post("/",req,function(res){if(res&&!res.error){location.reload();return}if(res.message&&res.error){showMessage(res.message,res.error)}setTimeout(function(){$("button",form).prop("disabled",false)},2e3)},"json")};jq_form.find("input[name=email]").on("input",removeMessage);function removeMessage(){jq_form.find(".messages").empty()}function showMessage(message,error){jq_form.find(".messages").empty().append($('<div class="message" />').html(message).toggleClass("success",!error).toggleClass("error",!!error))}};function show_sign_popup(text){window.sign_popup&&window.sign_popup.show()}function popup(id){this.visible=false;this.element=document.getElementById(id);this.overlay_element=$("<div id="+id+'-modal class=popup-style-1-modal style="display:none" />').appendTo(document.body)[0];this.style={};this.show=function(){this.visible=true;this.updatePos();$(this.element).fadeIn(100);$(this.overlay_element).fadeIn(100)};this.hide=function(){this.visible=false;$(this.element).fadeOut(100);$(this.overlay_element).fadeOut(100)};this.updatePos=function(){var css=$.extend({top:28,left:"50%"},this.style);$(this.element).css(css)}}$(function(){var $body=$("body");$body.on("keydown",".comment-phrase-index-input",function(e){if(e.which==13){change_comment_phrase_index($(this).data("comment_id"),parseInt($(this).val())-1)}});$(".toggle-sign-in-form").on("click",function(){$(".sign-in-form").toggle();$(".sign-in-form").find("input.sign-in-form__input").focus()});$body.on("click",".checkBox",function(){if($(this).parent().find("span").hasClass("checked")||$(this).parent().find("label").hasClass("checked")){$(this).parent().find("input").removeAttr("checked","checked").removeClass("checked");$(this).parent().find("span").removeClass("checked");$(this).parent().find("label").removeClass("checked")}else{$(this).parent().find("span").addClass("checked");$(this).parent().find("label").addClass("checked");$(this).parent().find("input").attr("checked","checked").addClass("checked")}$.ajax({type:"POST",url:"/",data:{ajax_call:"setCategories",teacher_id:$(this).find("input").val(),action:$(this).parent().find("input").hasClass("checked")?"on":"off"}})});$(".register-popup").on("click",function(e){e.preventDefault();e.stopPropagation();$.post("/",{ajax_action:"ajax_log_action",action:"mainregistration",value:$(this).data("type")},function(data){show_sign_popup()})});$(".add_word").on("click",function(){var user_episode_words=$("#user_episode_words");var current_row=$(this).toggle().parents("li");var current_data=$(this).parents("li");user_episode_words.append('<li class="balloon-row" data-post_id="'+current_data.data("post_id")+'" data-piece_index="'+current_data.data("piece_index")+'">'+current_row.html()+"</li>");if($(".puzzle-academy__popup").length>0){$(this).css("visibility","hidden")}else{current_row.remove()}$("#user_episode_words_wrapper").fadeIn();if(!$("#recomended_words_wrapper").has("li").length)$("#recomended_words_wrapper").fadeOut();$.post(window["HOME"],{ajax_action:"ajax_dictionary_addWord",word:$(this).data("word"),post_id:post_id,post_type:media_type,piece_index:$(this).data("piece_index"),translation:$(this).data("translation"),part_of_speech:$(this).data("part_of_speech")},function(){changeDictWordsCount()},"json")});$body.on("click",".switcher li:not(.active)",function(){var thisIndex=$(this).index(),$box=$("#"+$(this).closest(".switcher").data("box"));$(this).addClass("active").siblings("li").removeClass("active");$box.find("div.active").fadeOut(100,function(){var newBlock=$(this).parent().children("div")[thisIndex];$(this).removeClass("active");$(newBlock).fadeIn(100).addClass("active")});var $phrases_box=$("#phrases_example");$(this).addClass("active").siblings("li").removeClass("active");if($(this).hasClass("g_phrases")&&$phrases_box.length>0&&!$(this).data("requested")){$(this).data("requested",1);$phrases_box.addClass("loading-center");$.post("/",{ajax_action:"ajax_getPhrasesHtml",post_id:window.post_id,ret_type:"html"},function(html){$phrases_box.html(html).removeClass("loading-center");$("#j-phrases-autoloading").data("requested",0)},"html")}return false});if(/pe-movies__page/.test(document.body.className)){window.movie_popup=new popup("movie-popup");$(document).ready(function(){if(location.search=="?sections=info")return;movie_popup.style.position="absolute";movie_popup.style.top=160;movie_popup.style.left=video.offset().left+29;movie_popup.style.marginLeft=0;$(window).resize(function(){movie_popup.style.left=video.offset().left+29;movie_popup.visible&&movie_popup.updatePos()});movie_popup.show_explanation=function(element){if(!user.can_watch_movie){movie_popup.hide();$("html,body").animate({scrollTop:$("#video").offset().top},200);return}player.explanation.show(element,$(element).text())};movie_popup.show_quiz=function(index){if(!user.can_watch_movie){movie_popup.hide();return}player.quiz.show(index,true,true);this.hide();$("html,body").animate({scrollTop:$("#video").offset().top},200)};movie_popup.addAllWords2Dictionary=function(index){var user_episode_words=$("#user_episode_words");var $words=$("#recomended_words_wrapper");$words.toggle();$words.find("li").each(function(){$(this).find(".add_word").remove();user_episode_words.append("<li>"+$(this).html()+"</li>");$(this).remove()});$("#user_episode_words_wrapper").fadeIn();$.post(window["HOME"],{ajax_action:"ajax_dictionary_addEpisodeWords",post_id:post_id,post_type:media_type},function(resp){if(resp.success){movie_popup.hide()}},"json")}});$(".content .details a").click(function(e){var tabIndex=$(this).parents("div").index();movie_popup.show();$(".description-popup-header .switchers li:eq("+tabIndex+")").click()});if($("body").is(":not(.pe-movies__page)")){$(".description-popup-content").each(function(){this.scrollbar=new Scrollbar(this,this.id+"_scrollbar")})}thumbnail_slider($(".thumbs-wrap"))}$(".show_link").on("click",function(e){e.preventDefault();var that=$(this),type=$(this).data("type"),$example_window=$(".example-window");if($(".example-window:visible").length!==0&&$example_window.data("type")==that.data("type")){$example_window.hide();return}$("#output").html("");$(this).find(".preloader").show();$.post("/",{ajax_call:"get_example",movie_slug:$(this).data("movie_slug"),type:type},function(response){that.find(".preloader").hide();if(!response.error){var lp,tp=0;$("#output").html(response.html);var example_window=$(".example-window");lp=that.offset().left-example_window.width()/2;tp=that.offset().top+40;example_window.css({left:lp+"px",top:tp+"px"}).fadeIn("slow")}else{location.reload()}},"json")});$body.on("click","#j-btn-send__issue",function(){var $issue=$(".j-issue-checker.checked"),$msg=$("textarea[name=issue_msg]");var $jqAccordion=$("body").find("#movieLightFeedbackAccordeon");$jqAccordion.hide();var successMessage=document.createElement("div");successMessage.classList.add("puzzle-modal__success-message");successMessage.textContent="Ваша жалоба отправлена";$(this).css("display","none");$(this).parents(".puzzle-modal__content").append(successMessage);var pos=$jqAccordion.attr("data-pos");if($issue.length>0||$msg.length>0){$.post("/",{ajax_action:"ajax_movies_addIssue",msg:$msg.val(),issue_key:$issue.data("issue_key"),post_id:window.post_id,phrase_en:$(".b-phrases_block__phrases_list_item[data-pos="+pos+"] span.b-phrases_block__eng").text(),phrase_ru:$(".b-phrases_block__phrases_list_item[data-pos="+pos+"] span.b-phrases_block__ru").text(),pos_index:pos,ua:navigator.userAgent},function(){$msg.val("");$issue.removeClass("checked")})}})});function validateEmail(email){return/^(([^а-яё<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/i.test(email)}function sendFormResponse(pos){var movieLightFeedback=new jBox("Modal",{content:$("#puzzleLightFeedback"),closeButton:"box",addClass:"puzzle-modal",width:480,onCreated:function(){var $jqAccordion=$("body").find("#movieLightFeedbackAccordeon");$jqAccordion.accordion({collapsible:true,heightStyle:"content"})},onClose:function(){$("#movieLightFeedbackAccordeon").show();$("#j-btn-send__issue").css("display","");$(".puzzle-modal__success-message").remove()}});$("#movieLightFeedbackAccordeon").attr("data-pos",pos);movieLightFeedback.open()}function do_like_comment_fun(element,event,commentId,user_id,typeLike){event.preventDefault();event.stopPropagation();element=$(element);var elementBlock=$(".comment-likes-id-"+user_id+commentId),buttonLike=typeLike=="dislike"?".like":".dislike";if(!element.hasClass("used")){elementBlock.find("button").remove();return $.ajax({type:"POST",url:"/",data:{ajax_call:typeLike=="dislike"?"unlike_comment":"like_comment",comment_id:commentId,com_user_id:user_id,fun:1},success:function(json){elementBlock.find(buttonLike).removeClass("used");elementBlock.removeClass("negative neutral");elementBlock.find("span.comment-word").addClass("hide");elementBlock.toggleClass("m-slide_footer__like-used").parent().find(".count span").text(json.count);if(typeLike=="dislike"){elementBlock.find(".dislikeText").html(localize({l:"you_voted_against",v:'вы проголосовали "Против"',t:"first",n:"comments"}))}else{elementBlock.find(".likeText").html(localize({l:"you_liked_it",v:"вы проголосовали «За»",t:"first",n:"comments"}))}elementBlock.find(".comment-word").text("");if(json.count<0){elementBlock.addClass("negative ");elementBlock.find("span.comment-word").addClass("hide")}else if(json.count==0){elementBlock.removeClass("negative");elementBlock.addClass("neutral ");elementBlock.find("span.comment-word").addClass("hide")}}})}}function cancelLike(div,isPhrase){div=$(div);var idComment=parseInt(div.parent().find("span.count").attr("data-id"));var isNewTemplate=false;if(idComment<=0||isNaN(idComment)){isNewTemplate=true;idComment=parseInt(div.closest(".parentForLike").find("span.count").attr("data-id"))}if(typeof post_id==="undefined"){var post_id=idComment}const data={ajax_action:"ajax_unlike",data:{post_id:post_id,idComment:idComment}};$.post("/",data,function(json){var block=div.closest(".parentForLike");if(isNewTemplate!==true)block=div.parent();$(".likeText_"+idComment).hide();$(".dislikeText_"+idComment).hide();$(".cancelLike_"+idComment).hide();const disLike=$(".iconThumbDislike_"+idComment).find("i");const like=$(".iconThumbLike_"+idComment).find("i");disLike.removeClass("is-active cursor-default").attr("onclick",disLike.attr("data-onclick")).parent().show();like.removeClass("is-active cursor-default").attr("onclick",like.attr("data-onclick")).parent().show();var $count=block.find("span.count");$count.find("span").html(json.count);if(isPhrase===false){$count.removeClass("greenLike redLike");if(json.count<0)$count.addClass("redLike");else if(json.count>0)$count.addClass("greenLike")}},"json")}function do_like_pe_comments(e,commentId,typeLike){e&&e.preventDefault()&&e.stopPropagation();var elementBlock=$(".comment-likes-id-"+commentId);$.post("/",{ajax_call:typeLike=="dislike"?"unlike_comment":"like_comment",comment_id:commentId},function(json){const className=typeLike=="dislike"?"iconThumbDislike_":"iconThumbLike_";const otherThumbClass=typeLike=="dislike"?"iconThumbLike_":"iconThumbDislike_";const self=$("."+className+commentId).find("i");const selfOtherThumb=$("."+otherThumbClass+commentId).find("i");self.attr("data-onclick",self.attr("onclick")).attr("onclick","").addClass("is-active cursor-default");if(selfOtherThumb.hasClass("is-active"))selfOtherThumb.removeClass("is-active cursor-default").attr("onclick",selfOtherThumb.attr("data-onclick"));const $count=elementBlock.find(".count");$count.removeClass("greenLike redLike").find("span").text(json.count);if(json.count<0)$count.addClass("redLike");else if(json.count>0)$count.addClass("greenLike");const likeText=$(".likeText_"+commentId);const dislikeText=$(".dislikeText_"+commentId);likeText.hide();dislikeText.hide();typeLike=="dislike"?dislikeText.show():likeText.show();$(".cancelLike_"+commentId).show()},"json")}function do_like_post(element,event,postId,args){event.preventDefault();event.stopPropagation();element=$(element);var liked=element.hasClass("m-slide_footer__like-used")||element.hasClass("j-show-hide")||element.hasClass("j-unlike");return $.ajax($.extend({type:"POST",url:"/",data:{ajax_action:liked?"ajax_unlike_post":"ajax_like_post",post_id:postId},success:function(res){$(".j-like-btn-"+postId).toggleClass("m-slide_footer__like-used").parent().find(".j-slide_likes_counter").text(res.count)},dataType:"json"},args))}function do_like_with_animate(element,event,postId){if(event.target.tagName=="A")return true;var icon=$(".b-icon_link_block__favorite_icon");var post=do_like_post(element,event,postId,{beforeSend:function(){icon.animate({width:0})}}).always(function(res){icon.queue(function(){$(element).toggleClass("j-show-hide");icon.attr("src",icon.data(res&&res.me?"liked":"unliked")).dequeue()}).animate({width:28})})}function update_phrases_count(phrases_count){$("#phrases-count").html(phrases_count)}function thumbnail_slider(element){var $element=$(element);if(!$element.length)return;function timer(){timer.t=setInterval(next,4e3)}timer();$element.mouseenter(function(){clearInterval(timer.t)}).mouseleave(timer);var wheel_ev="mousewheel.thumbnail_slider";if(!browser.msie)wheel_ev+=" wheel.thumbnail_slider";$element.on(wheel_ev,function(e){var y=e.originalEvent.deltaY||-e.originalEvent.wheelDeltaY||-e.originalEvent.wheelDelta;if(y>0)next();else prev();e.preventDefault()});function next(){$element.children(".thumb:first").appendTo($element);$element.children(".thumb").each(function(i){this.className="thumb thumb-"+i})}function prev(){$element.children(".thumb:last").prependTo($element);$element.children(".thumb").each(function(i){this.className="thumb thumb-"+i})}}$(function(){var global_search=$(".input-promo_wrapper"),body=$("body");$(".j-upload-set_cover").on("click",function(e){e.stopPropagation();e.preventDefault();var $in=$("#j-upload-set_cover__input");$in.data("group_id",$(this).closest(".set-of-words__set_card").data("group_id"));$in.click()});$("#j-upload-set_cover__input").on("change",function(){var fd=new FormData,file={},group_id=$(this).data("group_id");if($(this).length!==0){fd.append("cover",$(this).get(0).files[0])}fd.append("ajax_action","ajax_set_uploadCover");fd.append("group_id",group_id);$.ajax({url:"/",type:"post",data:fd,processData:false,contentType:false,success:function(res){if(!res.success){alert("Error uploading file")}else{$('div[data-group_id="'+group_id+'"]').find("img").get(0).src=res.cover_path}}})});$(".j-like-post").on("click",function(event){var isLiked=$(this).hasClass("is-added");if(!isLiked){$(this).find("span").html(localize({l:"added",v:"добавлено",t:"first"}));$(this).addClass("is-added");do_like_post(this,event,$(this).data("post_id"))}else{$(this).find("span").html(localize({l:"add_to_favorites",v:"добавить в избранные",t:"first"}));$(this).removeClass("is-added");likeUnlikePost($(this).data("post_id"))}});function hideGlobalSearch(e){if(global_search.is(":visible")&&!global_search.is(e.target)&&global_search.has(e.target).length===0){global_search.animate({opacity:0,top:-100},200,function(){global_search.removeClass("active_but")});return true}return false}$(".input-promo").click(function(e){if(!hideGlobalSearch(e)){global_search.addClass("active_but").animate({opacity:1,top:$(this).data("top")||60},200)}e.stopPropagation()});function hide_serial_about(){var serial_descriptions=$(".b-description-wrap-layout:visible");if(serial_descriptions.length>0){$(serial_descriptions).each(function(){if(this.video_api){this.video_api.pause();if(this.video_api&&this.video_api.techName=="Flash"){$(this).css("left",-99999)}else{$(this).hide()}}else{$(this).hide()}})}}body.on("click",".b-description-link",function(){hide_serial_about();var $description=$(this).parent().next().show();var description=$description[0];var $video=$("video",description);if($video.length){var src=$video.attr("src");description.video_api=description.video_api||videojs($video[0]);if(!description.video_api.src())description.video_api.src(src);description.video_api.play();if(description.video_api.techName=="Flash"){$description.attr("style","display:block;")}}return false});body.on("click",function(e){hideGlobalSearch(e);if(!$(e.target).is(".b-description-wrap-layout")&&$(e.target).parents(".b-description-wrap-layout").length==0)hide_serial_about();var target=$(e.target);if(target.hasClass("ccurrency-more")||target.parent().hasClass("currency-more"))return;if(!target.hasClass("ccurrency")&&$(".ccurrency").has(e.target).length===0)$(".currency-picker-popup.opened").removeClass("opened")});$(".global_search_wrap .input-promo-button, .description").click(function(){$(".global_search_wrap.active_but, .description.active_but").css({display:"none"}).animate({opacity:"0"},400,function(){global_search.removeClass("active_but");return false})});$(document).on("click",".ccurrency, .currency-change",function(e){if($(this).hasClass("currency-more")){return}var currency_picker=$(".currency-picker-popup");if(currency_picker.hasClass("opened")){currency_picker.removeClass("opened");return}currency_picker.addClass("opened");var width=currency_picker.width();var $fixedPriceRow=$(this).parents(".buy-products__fixed-price .cprice-row");if($fixedPriceRow.length){var left=0;var top=-220;$fixedPriceRow.append(currency_picker)}else{$("body").append(currency_picker);var left=e.pageX-width/2;var top=e.pageY+25}currency_picker.css({top:top,left:left})});$(".currency").on("click",function(e){if($(this).hasClass("selected")&&!$(this).hasClass("currency-more")){return}if($(this).hasClass("currency-more")){$.each($(this).closest(".currency-picker").find("div.currency"),function(){$(this).removeClass("hidden")});$(this).hide();return}var currency=$(this).find("small").html();document.location.hash=currency.toLowerCase();$.ajax({url:"/",type:"post",dataType:"json",data:{ajax_action:"ajax_chooseCurrency",currency:currency},success:function(response){var currency_picker=$(".currency-picker-popup");currency_picker.find(".selected").removeClass("selected");currency_picker.find("[data-currency="+response.currency+"]").addClass("selected");$(".currency-picker").find(".selected").removeClass("selected");$(".currency-picker").find("[data-currency="+response.currency+"]").addClass("selected");$(".j-price-block").each(function(i){var $cprice=$(this).find(".cprice");var price_rub=parseFloat($cprice.data("pricerub"));var duration=$cprice.data("per_day_mode")?$cprice.data("duration"):1;$(this).find(".cprice").data("rate",response.rate).data("currency",response.currency).html(format_price(price_rub*response.rate/duration,response.currency,1,$cprice.data("per_day_mode")));$(this).find(".ccurrency").html(response.currency_svg)});currency_picker.removeClass("opened");window["user_currency"]=response.currency;if(typeof window["currency_change_callback"]==="function"){window["currency_change_callback"](response.currency)}location.reload()}})});$(".send-again_text").on("click",function(){var self=$(this);$.post("/",{ajax_action:"ajax_send_email_confirm"},function(res){self.replaceWith($("<span/>").text("письмо отправлено на "+res.email))})});body.on("click",function(e){var target=$(e.target),$self_close=$(".self-close");if(!target.hasClass("self-close")&&$self_close.has(e.target).length===0){$self_close.hide()}});$(".b-reg__block__change").on("click",function(){show_sign_popup();$(".sign-in-form").hide();$(".email-sign-in-form").show()});if(!body.is(".j-skip-browser-check")){var video=document.createElement("video");var audio=window.Audio&&new Audio;if(video.canPlayType&&video.canPlayType("video/mp4")&&audio&&audio.canPlayType&&audio.canPlayType("audio/mpeg"))return;$.post("/","ajax_action=ajax_get_browser_warning",function(res){if(res){$("body").prepend(res)}},"json")}});function format_price(price,currency,times,per_day_mode){var value=function(){per_day_mode=typeof per_day_mode==="undefined"?0:per_day_mode;if(per_day_mode)return Math.round(price*100)/100;times=typeof times==="undefined"?1:times;if(currency=="RUB")return Math.ceil(price)*times;return Math.ceil(price)*times}();return value.toString().replace(".",",")}function setupHeader(){$(".pe_slovnuk .dictionary_bg").html($(svg_icons.dictionary).clone());$("#header_wrap").on("click",".pe_heder-menu",function(){$(this).find(".drop-menu__mobile__main").toggleClass("is-open")});$("body").on("click",function(){$(".j-user_menu").stop().slideUp();$(".j-show_user_menu").removeClass("opened");if($(".pe_heder-menu > ul > li.menu-open").length===0){return}else{$(".pe_heder-menu .drop-menu > a").click()}});$("#header_search").click(function(e){if(e.target===this){$(this).toggleClass("active");if($(this).hasClass("active")){$(".header-menu-open").removeClass("header-menu-open");$(".pe_heder-menu").find(".sub-menu").slideUp(100)}}})}function openPopupWindow(options){var screenX=typeof window.screenX!="undefined"?window.screenX:window.screenLeft,screenY=typeof window.screenY!="undefined"?window.screenY:window.screenTop,outerWidth=typeof window.outerWidth!="undefined"?window.outerWidth:document.body.clientWidth,outerHeight=typeof window.outerHeight!="undefined"?window.outerHeight:document.body.clientHeight-22,width=options.width,height=options.height,left=parseInt(screenX+(outerWidth-width)/2,10),top=parseInt(screenY+(outerHeight-height)/2.5,10),features="width="+width+",height="+height+",left="+left+",top="+top;window.open(options.url,options.windowName,features)}$(document).ready(function(){$(".pe_heder-menu").find("li.drop-menu > a").on("click",function(e){e.preventDefault();if($(this).hasClass("header-menu-open")){$(this).removeClass("header-menu-open");$(this).siblings(".sub-menu").slideUp(100)}else{$("#header_search").removeClass("active");$(".header-menu-open").removeClass("header-menu-open");$(".pe_heder-menu").find(".sub-menu").slideUp(100);$(this).addClass("header-menu-open");$(this).siblings(".sub-menu").slideDown(100)}})});function WordSpeakerAudio(){var self=this;self.word=null;self.speakers=[];self.speaker_index=0;self.current_speaker=null;self.translations=[];self.translations_speakers=[];self.voiceparams="";self.audio=WordSpeakerAudio.audio=WordSpeakerAudio.audio||new Audio;self.init=function(){if(typeof self.speakers=="string"){self.speakers=self.parseSpeakers(self.speakers)}if(typeof self.translations_speakers=="string"){self.translations_speakers=self.parseSpeakers(self.translations_speakers)}};self.play=function(speaker_id){var safe_word=self.word.toLowerCase().replace(/[^a-z0-9\']+/gi,"-");var speaker=speaker_id?self.getSpeaker(speaker_id):self.getSpeakerByIndex(self.speaker_index);if(!speaker){speaker=self.getSpeakerByIndex(self.speaker_index=0)}if(speaker){var src=STATIC_URL_PREFIX+"/words/"+speaker.slug+"/"+safe_word+".mp3?"+self.voiceparams;if(self.audio.src!=src){self.audio.src=src}else{if(self.audio.readyState>2){self.audio.currentTime=0}}if(self.beforePlay){self.beforePlay()}self.audio.play();if(self.speakers_element){$(self.speakers_element).children().removeClass("is-active").filter("[data-id="+speaker.id+"]").addClass("is-active")}$("body").addClass("speaker-playing");if(!speaker_id){if(self.speaker_index>0)self.replay_count++;if(self.speaker_index<self.getEnabledSpeakers().length-1){self.speaker_index++}else{self.speaker_index=0}}self.afterPlay()}return self};self.getEnabledSpeakers=function(){var enabled_speakers=[];for(var i=0;i<self.speakers.length;i++){if(self.speakers[i].enabled){enabled_speakers.push(self.speakers[i])}}return enabled_speakers};self.sortSpeakersElements=function(){var speakers_elements=$(self.speakers_element).children();for(var i=0;i<self.speakers.length;i++){for(var j=0;j<speakers_elements.length;j++){var elem=speakers_elements[j];if(elem.dataset.id==self.speakers[i].id){self.speakers_element.appendChild(elem)}}}};self.getSpeakerGlobal=function(speaker_id){if(window.speakers instanceof Array){for(var i=0;i<window.speakers.length;i++){var obj=window.speakers[i];if(obj.id==speaker_id||obj.slug==speaker_id){return obj}}}else{console.error("Дикторы не подключены. Требуется наличие массива window.speakers")}};self.getSpeaker=function(speaker_id){if(speaker_id){for(var i=0;i<self.speakers.length;i++){if(self.speakers[i].id==speaker_id){return self.speakers[i]}}return}var first_enabled_speaker;for(var i=0;i<self.speakers.length;i++){if(self.speakers[i].enabled){if(!first_enabled_speaker)first_enabled_speaker=self.speakers[i];if(self.speakers[i].id==self.current_speaker.id){return self.speakers[i]}}}return first_enabled_speaker||false};self.getSpeakerByIndex=function(index,bagajSlov){index%=self.speakers.length;var first_enabled=null;for(var i=0,enabled_i=0;i<self.speakers.length;i++){if(self.speakers[i].enabled){if(first_enabled==null)first_enabled=self.speakers[i];if(index==enabled_i){return self.speakers[i]}enabled_i++}}if(typeof bagajSlov!=="undefined")return self.speakers[0];return first_enabled};self.replayTranslation=function(){var speakers=self.translations_speakers
	;for(var i=0;i<speakers.length;i++){if(speakers[i].enabled){if(self.translations.length===0)continue;var safe_word=self.translations[0].toLowerCase().replace(/[^a-zа-яё0-9-_]/gi,"");var src=window["STATIC_URL_PREFIX"]+"/words/russian/"+speakers[i].slug+"/"+encodeURIComponent(safe_word)+".mp3";self.audio.src=src;self.audio.play();break}}};self.parseSpeakers=function(str){if(!str)return false;if(str instanceof Array)return str;var speakers=[],parts,speaker;if(str.indexOf("|")==-1&&str.indexOf(",")!==-1){parts=str.split(",");for(var i=0;i<parts.length;i++){if(speaker=self.getSpeakerGlobal(parts[i])){speakers.push(speaker)}}}else{parts=str.split("|");for(var i=0;i<parts.length;i++){var parts2=parts[i].split("="),speaker_id=parts2[0],enabled=parts2[1]!=="0";if(!isNaN(speaker_id)){speaker=$.extend(true,{},self.getSpeakerGlobal(speaker_id));speaker.enabled=speaker.enabled&&enabled}else{speaker={slug:speaker_id,enabled:enabled}}speakers.push(speaker)}}return speakers};self.serializeSpeakers=function(speakers){var str="";for(var i=0;i<speakers.length;i++){str+=speakers[i].id+"="+(speakers[i].enabled?"1":"0");if(i!=speakers.length-1)str+="|"}return str};self.afterPlay=function(){};self.beforePlay=function(){}}var id_comment_for_like_dislike=0,ajax_request;$(document).ready(function(){$(".checkbox-line_js").on("click",function(event){event.preventDefault();if($(this).find("input").attr("checked")){$(this).find("input").removeAttr("checked");$(this).find(".check-box__target").removeClass("check-box__target_checked")}else{$(this).find("input").attr("checked","checked");$(this).find(".check-box__target").addClass("check-box__target_checked")}});$(".feedback-form-wrap__faq__slidedown").on("click",function openFeedbackInFaqlist(){$(this).parents(".main_content").find(".feedback-form").fadeIn(0);$(this).parents(".feedback-form-wrap").find(".feedback-form-wrap__faq").fadeOut(0);$(this).fadeOut(0);$(this).parents(".feedback-form-wrap").find(".feedback-form-wrap__feedback__slidedown__wrapper").fadeIn(0)});$(".feedback-form-wrap__feedback__slidedown__wrapper").on("click",function(){$(this).parents(".feedback-form-wrap").find(".feedback-form").fadeOut(0);$(this).fadeOut(0);$(this).parents(".feedback-form-wrap").find(".feedback-form-wrap__faq").fadeIn(0);$(this).parents(".feedback-form-wrap").find(".feedback-form-wrap__faq__slidedown").fadeIn(0)});var update_target_email=function(e){var target_email=$(this).val();if(validateEmail(target_email)){$(this).closest("div.gift-form").replaceWith(target_email);$(".payment_redirect_form input[name=target_user_email]").val(target_email);if($(this).data("update")){$.post("/",{ajax_action:"ajax_common_updateOrderTargetUser",order_id:window["order_id"],product:window["tariff"],email:target_email},null,"json")}}else{$(this).addClass("incorrect");$("p.gift-error").show();$(".payment_redirect_form input[name=target_user_email]").val("")}};$(".j-target-email").on("blur",update_target_email).on("keydown keyup",function(){$("p.gift-error").hide();$(this).removeClass("incorrect")});$(".j-apply-gift").on("click",update_target_email);$(".cancel-gift-mode").on("click",function(e){$(".payment_redirect_form input[name=target_user_email]").val("");$("#gift_title_wrap").hide()})});$(document).ready(function(){var body=$("body");if(typeof consumer!=="undefined"&&consumer==="english"){subscribe(10)}body.on("click",".j-checkbox-line",function(event){event.preventDefault();if($(this).find("input").attr("checked")){$(this).find("input").removeAttr("checked");$(this).find(".check-box__target").removeClass("check-box__target_checked")}else{$(this).find("input").attr("checked","checked");$(this).find(".check-box__target").addClass("check-box__target_checked")}});body.on("click",".checkbox-line_js-vitamin",function(event){event.preventDefault();if($(this).find("input").attr("checked")){$(this).find("input").removeAttr("checked");$(this).find(".check-box__target").removeClass("check-box__target_checked");$.ajax({type:"POST",url:"/",data:{ajax_action:"ajax_setUnSubscribe",type:$(this).find("input").val()},dataType:"json"})}else{$(this).find("input").attr("checked","checked");$(this).find(".check-box__target").addClass("check-box__target_checked");$.ajax({type:"POST",url:"/",data:{ajax_action:"ajax_setSubscribe",type:$(this).find("input").val()},dataType:"json"})}});body.on("click",".radio-button",function(){if(!$(this).hasClass("is-checked")){$(this).parents(".radio-button__group").find(".radio-button").removeClass("is-checked");$(this).addClass("is-checked");$(this).find("input").prop("checked","true")}});body.on("click",".puzzle-banner",function(e){$.post("/api2/banner/log_click",{bannerID:$(this).attr("data-banner-id")})});body.on("click",".puzzle-banner__wrapper .j-puzzle-icon_close",function(e){e.preventDefault();var cookie_val=cookie.get("data-banner-id_hidden");if(cookie_val){cookie.set("data-banner-id_hidden",cookie_val+","+$(this).attr("data-banner-id"),230)}else{cookie.set("data-banner-id_hidden",$(this).attr("data-banner-id"),230)}$(this).parents(".puzzle-banner__wrapper").css("display","none")});body.on("click",".comment-balloon",function(e){e.stopPropagation()});var ajaxRequest=false;body.on("click mouseenter",".comment-likes span.count, .comment-likes-not-auth span.count, span.count",function(e){var id_comment=$(this).data("id");if(id_comment_for_like_dislike!=id_comment&&typeof ajax_request!=="undefined"&&ajax_request!==null){id_comment_for_like_dislike=id_comment;$(".comment-balloon").css("display","none");ajax_request.abort()}var is_fun=$(this).attr("data-comment");var post_type=$(this).data("post_type");var container=$(this).find(".comment-balloon .ldComment_"+id_comment);ajax_request=$.ajax({type:"POST",url:"/",data:{ajax_action:"ajax_getUserStats",id_comment:id_comment,is_fun:is_fun,post_type:post_type},dataType:"json",success:function(data){ajaxRequest=false;container.empty();$.each($(".comment-balloon"),function(index,value){if($(value).attr("data-id")!=id_comment)$(value).css("display","none")});if(data!=""&&data[0]["like_value"]===undefined&&is_fun===undefined){container.html(data);container.parent().css("display","block");body.off("click.likers")}else{if(data.length>0){for(var i=0,length=data.length;i<length;i++){var typeLike="";if(data[i]["like_value"]>0){typeLike="puzzle-icon puzzle-icon_thumb-up"}else{typeLike="puzzle-icon puzzle-icon_thumb-down"}container.append($("<a/>").addClass("comment-balloon__item").attr("href","/user/"+data[i]["user_id"]).attr("target","_blank").append($("<div/>").addClass("comment-balloon__item_icon puzzle_va_middle").append($("<i/>").addClass(typeLike).append($(data[i]["button"]))),$("<div/>").addClass("comment-balloon__item_pic puzzle_va_middle round-avatar").append($("<img/>").attr("src",data[i]["photo_user"])),$("<div/>").addClass("comment-balloon__item_text puzzle_va_middle").append($("<div/>").addClass("comment-balloon__item_text_name puzzle-text puzzle-text_fz_14 puzzle-text_c_fff-white puzzle-text_fw_bold").text(data[i]["display_name"]),$("<div/>").addClass("comment-balloon__item_text_date puzzle-text puzzle-text_fz_12 puzzle-text_c_858585-lightgray").text(data[i]["ts"]))))}container.css("display","block");container.parent().css("display","block")}}body.on("click.likers",function(){if(typeof ajax_request!=="undefined")ajax_request.abort();$(".comment-balloon").css("display","none");body.off("click.likers")})}})})});function openVkShare(purl,title,description,image){var url="http://vk.com/share.php?";url+="title="+encodeURIComponent(title);url+="&description="+encodeURIComponent(description);if(image!=""){url+="&image="+encodeURIComponent(image)}console.log(url);url+="&url="+encodeURIComponent(purl);openPopupWindow({width:665,height:370,url:url})}function openOkShare(url){console.log(url);openPopupWindow({width:665,height:370,url:"http://connect.ok.ru/dk?st.cmd=WidgetSharePreview&st.app=1141348096&st.shareUrl="+encodeURIComponent(url)})}function openFbShare(purl,title,text,pimg){var url="https://www.facebook.com/dialog/feed?";url+="app_id=1463689653923306";url+="&description="+encodeURIComponent(text);url+="&display=popup";if(pimg)url+="&picture="+encodeURIComponent(pimg);url+="&redirect_uri="+encodeURIComponent(purl);url+="&link="+encodeURIComponent(purl);openPopupWindow({width:665,height:370,url:url})}function unSubscribe(id_type){$.ajax({type:"POST",url:"/",data:{ajax_action:"ajax_setUnSubscribePush",id_type:id_type},dataType:"json"})}function subscribe(id_type){if("serviceWorker"in navigator){navigator.serviceWorker.register("/service-worker.js").catch(function(e){});navigator.serviceWorker.ready.then(function(serviceWorkerRegistration){serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:true}).then(function(subscription){var b=subscription.endpoint.split(gcmServer);$.ajax({type:"post",url:"/",data:{ajax_action:"ajax_setPushUser",key:b[1],id_type:id_type},datatype:"json"})}).catch(function(e){})})}else{return false}}function checkWebPush(){if(typeof ServiceWorkerRegistration==="undefined")return false;if(!("showNotification"in ServiceWorkerRegistration.prototype)){console.dir("Notifications aren't supported.");return false}if(Notification.permission==="denied"){console.dir("The user has blocked notifications.");return false}if(!("PushManager"in window)){console.dir("Push messaging isn't supported.");return false}return true}function initialiseState(id_type){if(checkWebPush()!=true)return;navigator.serviceWorker.ready.then(function(serviceWorkerRegistration){serviceWorkerRegistration.pushManager.getSubscription().then(function(subscription){if(!subscription){return}var b=subscription.endpoint.split(gcmServer);$.ajax({type:"POST",url:"/",data:{ajax_action:"ajax_setPushUser",key:b[1],id_type:id_type},dataType:"json"});isPushEnabled=true}).catch(function(err){console.dir("Error during getSubscription()",err)})})}$(document).ready(function(){var $body=$("body");$(".j-load-series").on("click",function(){var $button=$(this);$button.addClass("loading");$.post("/",{ajax_action:"ajax_loadSeries",series_type:$(this).data("type")},function(response){$button.removeClass("loading");$button.closest(".b-list__item").find("ul.b-list-serials").append(response.html);$button.remove()},"json")});$("#search-series-form").on("submit",function(e){e.preventDefault();$.post("/",{ajax_action:"ajax_loadSeriesLike",like:$("#search-series-form").find("input").val()},function(response){$(".b-list__item").hide();$(".b-list__item.series-type0").show().find("ul.b-list-serials").html(response.html)},"json")});$("#puzzle-sort__series").find(".puzzle-sort__item").on("click",function(e){var $item=$(this);$(".puzzle-sort__item").removeClass("puzzle-sort__item_status_active");if($item.data("sort_by")==="term_taxonomy"){$(".b-list__item").show();$(".b-list__item.series-type0").hide();$item.addClass("puzzle-sort__item_status_active");return}$item.find("small").addClass("loading");$.post("/",{ajax_action:"ajax_loadSeriesLike",sort_by:$item.data("sort_by")},function(response){$item.find("small").removeClass("loading");$(".b-list__item").hide();$(".b-list__item.series-type0").show().find("ul.b-list-serials").html(response.html);$item.addClass("puzzle-sort__item_status_active")},"json")});if($(".puzzle-slide-down_js").length){$(".puzzle-slide-down_js").each(function(index,el){var slideTarget=document.getElementById($(this).data("slide"));if(!$(slideTarget).is(":visible")){$(this).addClass("is-up")}})}$(document).on("click",".puzzle-slide-down_js",function contentSlideDown(event){event.preventDefault();var slideTarget=document.getElementById($(this).data("slide"));if(!$(slideTarget).is(":visible")){$(this).parents(".teacher-level_wrapper").find(".teacher-level__content").slideUp(400);$(this).parents(".teacher-level_wrapper").find(".puzzle-slide-down_js").addClass("is-up");$(slideTarget).slideDown(400);$(this).removeClass("is-up")}});$body.on("click",".j-slow-ratio__speed-change",function(){$(this).siblings(".slow-ratio__speed-range").fadeToggle(300)});$(document).mouseup(function(e){var container=$(".j-slow-ratio__speed-range");var targetLink=$(".j-slow-ratio__speed-change");if(!container.is(e.target)&&container.has(e.target).length===0&&!targetLink.is(e.target)&&targetLink.has(e.target).length===0){container.fadeOut(300)}});$body.on("change",".j-slowRatioRange",function(){var target=$(this).parents(".slow-ratio__speed-range").siblings(".slow-ratio__speed-change");var slowRatioValue=$(this).val();var $currentAudio=$(audio.obj).get(0);var isFirefox=document.documentElement.classList.contains("firefox");switch(+slowRatioValue){case 0:target.html(localize({l:"slowdown",v:"замедление",t:"first",n:"tasks"})+" 0.3");$currentAudio.playbackRate=isFirefox?.7:.5;$(this).parents(".slow-ratio__button").find(".play-button , .button-play-big").addClass("slowMode-js").removeClass("is-fast");break;case 1:target.html(localize({l:"slowdown",v:"замедление",t:"first",n:"tasks"})+" 0.5");$currentAudio.playbackRate=isFirefox?.8:.66;$(this).parents(".slow-ratio__button").find(".play-button , .button-play-big").addClass("slowMode-js").removeClass("is-fast");break;case 2:target.html(localize({l:"slowdown",v:"замедление",t:"first",n:"tasks"})+" 0.75");$currentAudio.playbackRate=isFirefox?.9:.75;$(this).parents(".slow-ratio__button").find(".play-button , .button-play-big").addClass("slowMode-js").removeClass("is-fast");break;case 3:target.html(localize({l:"havent_slow_phrase",v:"замедления нет",n:"tasks",t:"first"}));$currentAudio.playbackRate=1;$(this).parents(".slow-ratio__button").find(".play-button , .button-play-big").removeClass("slowMode-js").removeClass("is-fast");break;case 4:target.html("Ускорение 2x");$currentAudio.playbackRate=2;$(this).parents(".slow-ratio__button").find(".play-button , .button-play-big").addClass("slowMode-js").addClass("is-fast");break}});$("body").on("click",".popover--settings-video__slow-set-range-values span",function(e){var i=$(this).index(),isFirefox=document.documentElement.classList.contains("firefox"),isPageListening=document.body.classList.contains("page-listening"),buttonClass=isPageListening?".button-play-big":".play-button",slowPlaybackRate=1,addSlowClass=false,addFastClass=false,slowText=localize({l:"havent_slow_phrase",v:"замедления нет",n:"tasks",t:"first"}),$wrapper=$(this).parents(".slow-ratio__button"),$buttonNode=$wrapper.find(buttonClass),$buttonTextNode=$wrapper.find(".slow-ratio__speed-change"),$inputRangeNode=$wrapper.find(".slowRatioRange"),audioObj=audio.obj;switch(i){case 0:addSlowClass=true;addFastClass=false;slowText=localize({l:"slowdown",v:"замедление",t:"first",n:"tasks"})+" 0.3";slowPlaybackRate=isFirefox?.7:.5;break;case 1:addSlowClass=true;addFastClass=false;slowText=localize({l:"slowdown",v:"замедление",t:"first",n:"tasks"})+" 0.5";slowPlaybackRate=isFirefox?.8:.66;break;case 2:addSlowClass=true;addFastClass=false;slowText=localize({l:"slowdown",v:"замедление",t:"first",n:"tasks"})+" 0.75";slowPlaybackRate=isFirefox?.9:.75;break;case 3:addSlowClass=false;addFastClass=false;slowText=localize({l:"havent_slow_phrase",v:"замедления нет",n:"tasks",t:"first"});slowPlaybackRate=1;break;case 4:addSlowClass=true;addFastClass=true;slowText="Ускорение 2x";slowPlaybackRate=isFirefox?2:2;break}$inputRangeNode.val(i);addSlowClass?$buttonNode.addClass("slowMode-js"):$buttonNode.removeClass("slowMode-js");addFastClass?$buttonNode.addClass("is-fast"):$buttonNode.removeClass("is-fast");$buttonTextNode.html(slowText);audioObj.playbackRate=slowPlaybackRate});$body.on("click",".j-resetSlowlyButtons_js",function(){$(".phrase-wrap_status_active").removeClass("phrase-wrap_status_active");$(this).parents(".phrase_wrap").addClass("phrase-wrap_status_active");var $notActiveItem=$(this).parents("#phrases").find(".phrase_wrap:not(.phrase-wrap_status_active)");$notActiveItem.find(".slowMode-js").removeClass("is-fast");$notActiveItem.find(".slowMode-js").removeClass("slowMode-js");$notActiveItem.find(".play-button.active").removeClass("active");$notActiveItem.find(".slow-ratio__speed-change").html(localize({l:"havent_slow_phrase",v:"замедления нет",n:"tasks",t:"first"}));$notActiveItem.find(".slowRatioRange").val("3")});$body.on("click",".series-films__favorite-ribbon_js_click",function(){var action=1;if($(this).hasClass("is-favorite")){$(this).removeClass("is-favorite");$(this).find(".series-films__favorite-ribbon-text").html("В избранное");action=0}else{$(this).addClass("is-favorite");$(this).find(".series-films__favorite-ribbon-text").html("Удалить<br>из избранного")}likeUnlikePost($(this).data("post_id"),action,$(this).data("post_type"))})});$(document).ready(function(){$(".top-sidebar_js_close").on("click",function(event){event.preventDefault();cookie.set("top_sidebar_closed",1,3600*24*31,"/");$(this).parent().css("display","none")})});$(document).ready(function(){var lessonPlanLeft=$(".b-lesson-plan__wrapper").length;if(lessonPlanLeft>0){$(".left-sidebar").hide();$(".puzzle-ontop").css("bottom","10px")}});$(document).ready(function(){$("body").on("click",".j-inner-hide_phrase_comments",function(){if($("body").is(".listening")){var $commentsContainer=$(this).parents(".task__comments-container");var countComments=$(this).parents("div.TaskBlock").find(".j-comments_list .comment").length;if(countComments>0){$commentsContainer.siblings(".task-wrapper").find(".task__show-comments").html('<span class="b-phrases_block__title_content j-comment_block_title">'+localize({l:"comments",v:"комментарии",t:"first",n:"comments"})+'</span><span class="b-phrases_block__title_info j-comment_block_info"><span class="b-phrases_block__comment_amount j-comment_amount">'+countComments+"</span></span>").removeClass("opened")}else{$commentsContainer.siblings(".task-wrapper").find(".task__show-comments").text("Обсудить эту фразу").removeClass("opened")}$commentsContainer.removeClass("opened");$("html, body").animate({scrollTop:$commentsContainer.parents(".task__item").offset().top+"px"},{duration:200})}else{var $phrasesListItem=$(this).parents(".b-phrases_block__phrases_list_item");$phrasesListItem.find(".b-phrases_block__comments_wrapper").slideUp(400);$phrasesListItem.find(".b-phrases_block__comments_block.opened .j-comment_block_title").removeClass("m-phrases_block__title_down").html(localize({l:"comments",v:"комментарии",t:"first",n:"audiopuzzles"}));$phrasesListItem.find(".b-phrases_block__comments_block__work").removeClass("opened");$("html, body").animate({scrollTop:$phrasesListItem.offset().top+"px"},{duration:200})}})});$(document).ready(function(){$("body").on("click",".b-list-serials__watch_js_click",function(){var watched=1;if($(this).is(".status-watched")){$(this).removeClass("status-watched");$(this).attr("title","отметить как просмотрено");watched=0}else{$(this).addClass("status-watched");$(this).attr("title","серия просмотрена")}watchEpisode($(this).data("post_id"),watched)});$(document).on("click",".vteacher__header__profile",function(e){var menuList=$(this).siblings(".vteacher__header__profile__menu");if(!menuList.length){menuList=$(this).parents(".vteacher__header-px").find(".vteacher__header__profile__menu")}if($(this).hasClass("is-open")){$(this).removeClass("is-open");menuList.slideUp(150)}else{$(this).addClass("is-open");menuList.slideDown(150)}});$(document).on("click",function(event){var target=event.target;while(target!=this){if(target===null||target.classList.contains("vteacher__header__profile__menu")||target.classList.contains("vteacher__header__profile"))return;target=target.parentNode}$(".vteacher__header__profile").removeClass("is-open");$(".vteacher__header__profile__menu").slideUp(150)});$(document).ready(function(){if($("html").hasClass("no-touchscreen")||$("html").hasClass("pc")){$(document).on("mouseenter",".puzzle-header__menu__user_js_hover",function(){$(this).find(".puzzle-header__popup").addClass("is-hover")});$(document).on("mouseleave",".puzzle-header__menu__user_js_hover",function(){$(this).find(".puzzle-header__popup").removeClass("is-hover")})}else{$(document).on("touchstart",".puzzle-header__menu__user_js_hover",function(e){if($(e.target).parents(".puzzle-header__popup").length)return;var $target=$(this).find(".puzzle-header__popup");$target.hasClass("is-hover")?$target.removeClass("is-hover"):$target.addClass("is-hover")})}});$(document).ready(function(){$(".puzzle-switcher_js_click").on("click",".puzzle-switcher__item:not(.is-active)",function(){var id="#"+$(this).data("content");$(this).parents(".puzzle-switcher").find(".puzzle-switcher__item").removeClass("is-active");$(this).addClass("is-active");$(this).parents(".puzzle-switcher__content").find(".puzzle-switcher__content-item").css("display","none");$(id).css("display","")})});if($("html").hasClass("phone")||$("html").hasClass("iphone")){$(".currencies-row p").on("click",function(e){var parent=$(this).parents(".currencies-row");parent.find(".currency-picker").slideToggle(400);parent.find(".currency").removeClass("hidden");parent.find(".currency-more").addClass("hidden")})}});function updateBallonSortable(req){$.post("/",req,function(res){},"json")}$(document).ready(function(){$("body").on("click",".balloon__trigger-box_js_click",function(){var type_block=$(this).data("type_block");var req={ajax_action:"ajax_balloon_save_settings",roll_up:true,what_block:type_block};if($(this).hasClass("is-open")){req.action=0;$(this).removeClass("is-open");$(this).siblings(".balloon__content-wrapper").slideUp(400)}else{req.action=1;$(this).addClass("is-open");$(this).siblings(".balloon__content-wrapper").slideDown(400)}updateBallonSortable(req)});$("#user_file").on("change",function(){var matches=/^(.*)(\\|\/)([^\\\/]*)$/.exec($(this).val());var fileName=matches&&typeof matches[3]!=="undefined"?matches[3]:"";$("#user_file-filename").text("("+fileName+")")});function phraseResizeWithVideo(videoWidth){if(videoWidth>880){if(videoWidth>950){$(".page-video .puzzle-game .phrase").css("max-width","")}else{$(".page-video .puzzle-game .phrase").css("max-width",1200-videoWidth-90)}}else{$(".page-video .puzzle-game .phrase").css("max-width",1200-videoWidth-140)}};$(".video-carousel__item").on("click",".js-tab-link",function(){var dataId=$(this).data("id");if(dataId=="regForm"){$(this).parents(".modal-style-4").find(".social-auth-btn_vk .social-auth-btn__text").text("Регистрация через Вконтакте")}else if(dataId=="authForm"){$(this).parents(".modal-style-4").find(".social-auth-btn_vk .social-auth-btn__text").text("Войти через Вконтакте")}});var textArea=$('.writing-list__item[data-piece_index="0"]').find(".writing-textarea_wrapper textarea");textArea.on("input",function(e){var valueLastSymbol=textArea.val().slice(-3).slice(0,2);if(valueLastSymbol==". "){$(".writing-hints__error_js_show").css("display","")}})});